#!/bin/bash

printGreen() {
    echo -e "\033[32m$1\033[0m"
}

printLine() {
    echo "------------------------------"
}

# Color definitions (for colored terminal output)
GREEN="\e[1m\e[1;32m"
NC="\e[0m"

# MICTONODE ASCII logo display function
function printMictoNode {
  echo -e "${GREEN}"
  echo "@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@"
  echo "@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@"
  echo "@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@"
  echo "@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@"
  echo "@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@"
  echo "@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@"
  echo "@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@"
  echo "@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@"
  echo "@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@"
  echo "@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@"
  echo "@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@"
  echo "@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@"
  echo "@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@"
  echo "@=======================================================================================+@"
  echo "@ =%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%                                           .@"
  echo "@ +@@@*******@@@@@@@@@@@@@@@@@@@@@%******#@@@      .:::::::                 .:::::.     .@"
  echo "@ +@@#       :%@@@@@@@@@@@@@@@@@@*       .@@@      -@@@@@@@@=               =@@@@@+     .@"
  echo "@ +@@#         *@@@@@@@@@@@@@@@@-        .@@@      -@@@@@@@@@%-             =@@@@@+     .@"
  echo "@ +@@#          -@@@@@@@@@@@@@#.         .@@@      -@@@@@@@@@@@#.           =@@@@@+     .@"
  echo "@ +@@#           .#@@@@@@@@@@=           .@@@      -@@@@@%@@@@@@@*.         =@@@@@+     .@"
  echo "@ +@@#      .      +@@@@@@@%:      .     .@@@      -@@@@@* +@@@@@@@=        =@@@@@+     .@"
  echo "@ +@@#      @=      :%@@@@*       #*     .@@@      -@@@@@*  .*@@@@@@%-      =@@@@@+     .@"
  echo "@ +@@#      @@*       *@@-      :@@*     .@@@      -@@@@@*    :#@@@@@@%:    =@@@@@+     .@"
  echo "@ +@@#      @@@%:      -.      +@@@*     .@@@      -@@@@@*      -%@@@@@@*.  =@@@@@+     .@"
  echo "@ +@@#      @@@@@+           .%@@@@*     .@@@      -@@@@@*        =@@@@@@@+ =@@@@@+     .@"
  echo "@ +@@#      @@@@@@%.        =@@@@@@*     .@@@      -@@@@@*          *@@@@@@@#@@@@@+     .@"
  echo "@ +@@#      @@@@@@@@-      *@@@@@@@*     .@@@      -@@@@@*           .#@@@@@@@@@@@+     .@"
  echo "@ +@@#      @@@@@@@@@%%%%%@@@@@@@@@*     .@@@      -@@@@@*             :%@@@@@@@@@+     .@"
  echo "@ +@@#      @@@@@@@@@@@@@@@@@@@@@@@*     .@@@      -@@@@@*               =@@@@@@@@+     .@"
  echo "@ +@@@+++++*@@@@@@@@@@@@@@@@@@@@@@@%+++++*@@@      .-----:                 -------:     .@"
  echo "@ +%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%                                           .@"
  echo "@========================================================================================@"
  echo "@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@"
  echo "@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@"
  echo "@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@"
  echo "@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@"
  echo "@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@"
  echo "@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@"
  echo "@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@"
  echo "@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@"
  echo "@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@"
  echo "@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@"
  echo "@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@"
  echo "@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@CoreNodeCommunity"
  echo -e "${NC}"
}

# Menu function
show_menu() {
    echo "====================="
    echo "      MENU           "
    echo "====================="
    echo "1. Warden Install"
    echo "2. Slinky Install"
    echo "3. Sync Check"
    echo "4. Exit"
    echo "====================="
    echo -n "Make your choice [1-4]: "
}

# Function to download and run a script from GitHub
run_script_from_github() {
    local url=$1
    local script_name="micto.sh"

    # Remove old script (if exists)
    [ -f $script_name ] && rm -f $script_name

    # Download the script
    wget -q -O $script_name $url

    # Check if the script was downloaded
    if [ -f $script_name ]; then
        # Ensure dos2unix is installed
        check_and_install_dos2unix

        # Convert to Unix format (LF)
        dos2unix $script_name

        # Make the script executable
        chmod +x $script_name
        
        # Run the script
        ./$script_name

        # Optionally, delete the script after execution
        rm -f $script_name
    else
        echo "Failed to download the script!"
    fi
}

check_and_install_dos2unix() {
    if ! command -v dos2unix &> /dev/null; then
        echo "dos2unix is not installed. Installing..."
        sudo apt-get install -y dos2unix
    fi
}

# Main program

# Display MICTONODE logo
printMictoNode

# Wait for 1 second
sleep 1

# Menu loop
while true; do
    show_menu
    read choice

    case $choice in
        1)
            echo "Running Warden Install..."
            run_script_from_github "https://raw.githubusercontent.com/MictoNode/warden-protocol/refs/heads/main/mictonode_setup.sh"
            ;;
        2)
            echo "Running Slinky Install..."
            run_script_from_github "https://raw.githubusercontent.com/MictoNode/warden-protocol/refs/heads/main/slinky-setup.sh"
            ;;
        3)
            echo "Running Sync Check..."
            run_script_from_github "https://raw.githubusercontent.com/MictoNode/warden-protocol/refs/heads/main/checksync.sh"
            ;;
        4)
            echo "Exiting menu..."
            break
            ;;
        *)
            echo "Invalid choice, please try again."
            ;;
    esac
done
